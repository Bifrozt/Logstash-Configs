input {
  udp {
    port => 5999
    type => "nxlog"
#    codec => json_lines { charset => "UTF-8" }
  }
}

filter {
  if [type] == "nxlog" {
    json {
      source => "message"
    }
    date {
      match => ["EventTime", "YYYY-MM-dd HH:mm:ss"]
    }
    if [SourceModuleName] == "eventlog" {
      mutate {
   #     remove_field => [ "message" ]
	replace => { "host" => "%{MessageSourceAddress}" }
      }
    }
    mutate {
      rename => [ "UserName", "Username" ]
      rename => [ "userName", "Username" ]
      rename => [ "User", "Username" ]
      rename => [ "user", "Username" ]
      rename => [ "UserID", "Username" ]
    }
    if [host] =~ "^10\.[2-9]\.\d\.\d+$" {
      mutate {
        add_tag => [ "hipaa" ]
      }
    }
    if [host] =~ "^10\.[2-9]\.\d{2}\.\d+$" {
      mutate {
        add_tag => [ "hipaa" ]
      }
    }
    if [host] =~ "^192\.168\.\d{3}\.\d+$" {
      mutate {
        add_tag => [ "hipaa" ]
      }
    }
  }
}


output {
  if [type] == "nxlog" {
#    if [host] == "10.0.36.104" {
#      stdout { codec => rubydebug }
#    }
    elasticsearch {
      cluster => "heartland"
      protocol => http
    }
  }
}

