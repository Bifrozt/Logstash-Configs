input {
	tcp {
		port => 7001
		type => "iis"
	}
}

filter {
  if [type] == "iis" {
    json {
      source => "message"
    }
    if [host] =~ "^10\.[2-9]\.\d\.\d+$" {
      mutate {
        add_tag => [ "hipaa" ]
      }
    }
    if [host] =~ "^10\.[2-9]\.\d{2}\.\d+$" {
      mutate {
        add_tag => [ "hipaa" ]
      }
    }
    if [host] =~ "^192\.168\.\d{3}\.\d+$" {
      mutate {
        add_tag => [ "hipaa" ]
      }
    }
	mutate {
		remove_field => [ "message"]
		add_tag => [ "web" ]
	}
  }
}

output {
	if [type] == "iis" {
#		stdout { codec => rubydebug }
		elasticsearch {
			cluster => "heartland"
			protocol => "http"
			embedded => false
		}
	}
}
